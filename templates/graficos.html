{% extends "base.html" %}
{% block content %}
<h1>Gráficos Interactivos</h1>

<p>En esta pestaña, se visualizarán gráficos interactivos basados en los datos abiertos seleccionados sobre los indicadores de la calidad del agua.</p>

<label for="grafico-selector">Selecciona un gráfico:</label>
<select id="grafico-selector">
    {% for i in range(1,11) %}
    <option value="grafico{{ i }}">Gráfico {{ i }}</option>
    {% endfor %}
</select>

<!-- Contenedor principal para el gráfico -->
<div id="grafico-container" style="width:100%; height:700px;"></div>

<!-- Script de Tableau (solo una vez) -->
<script type="text/javascript" src="https://public.tableau.com/javascripts/api/viz_v1.js"></script>

<script>
const graficoSelector = document.getElementById('grafico-selector');
const contenedor = document.getElementById('grafico-container');

// URLs de los gráficos
const graficosURLs = {
    "grafico1": "https://public.tableau.com/shared/6BQWHKWMP?:display_count=n&:origin=viz_share_link",
    "grafico2": "https://public.tableau.com/shared/QWKRHW9RP?:display_count=n&:origin=viz_share_link",
    "grafico3": "https://public.tableau.com/views/SistemadeMonitoreoyAnalisisdelaCalidaddelAgua/grafico3",
    "grafico4": "https://public.tableau.com/views/SistemadeMonitoreoyAnalisisdelaCalidaddelAgua/grafico4",
    "grafico5": "https://public.tableau.com/views/SistemadeMonitoreoyAnalisisdelaCalidaddelAgua/grafico5",
    "grafico6": "https://public.tableau.com/views/SistemadeMonitoreoyAnalisisdelaCalidaddelAgua/grafico6",
    "grafico7": "https://public.tableau.com/views/SistemadeMonitoreoyAnalisisdelaCalidaddelAgua/grafico7",
    "grafico8": "https://public.tableau.com/views/SistemadeMonitoreoyAnalisisdelaCalidaddelAgua/grafico8",
    "grafico9": "https://public.tableau.com/views/SistemadeMonitoreoyAnalisisdelaCalidaddelAgua/grafico9",
    "grafico10": "https://public.tableau.com/views/SistemadeMonitoreoyAnalisisdelaCalidaddelAgua/grafico10"
};

// Función para cargar el gráfico seleccionado
let currentViz = null;
function cargarGrafico(graficoKey) {
    // Limpiar contenedor
    contenedor.innerHTML = "";
    if(currentViz) currentViz.dispose();

    const url = graficosURLs[graficoKey];
    const placeholder = document.createElement("div");
    placeholder.className = "tableauPlaceholder";
    placeholder.style.width = "100%";
    placeholder.style.height = "100%";
    contenedor.appendChild(placeholder);

    currentViz = new tableau.Viz(placeholder, url, {
        width: "100%",
        height: "100%",
        hideTabs: true,
        hideToolbar: false
    });
}

// Inicializar primer gráfico
cargarGrafico("grafico1");
graficoSelector.value = "grafico1";

// Cambiar gráfico al seleccionar
graficoSelector.addEventListener("change", () => {
    cargarGrafico(graficoSelector.value);
});
</script>

{% endblock %}




